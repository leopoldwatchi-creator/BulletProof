<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Échiquier Simple</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="chessboard"></div>

    <script type="module">
        // On importe les deux bibliothèques dont nous avons besoin avec les URL correctes et testées
        import { Chess } from "https://cdn.jsdelivr.net/npm/chess.js@1.0.0-beta.8/+esm";
        import { Chessboard, FEN } from "https://cdn.jsdelivr.net/npm/cm-chessboard@8.5.4/+esm";

        // 1. On initialise la logique du jeu d'échecs
        const game = new Chess();

        // 2. On récupère l'élément HTML où l'échiquier doit apparaître
        const boardElement = document.getElementById("chessboard");

        // 3. C'est la fonction qui est appelée à chaque fois qu'un joueur tente un coup
        function handleMove(event) {
            const { from, to } = event.detail;
            
            // On essaie de jouer le coup. 
            // Si le coup est illégal, la fonction `game.move` renverra `null`.
            const move = game.move({ from, to, promotion: "q" });

            if (move === null) {
                console.log("Coup illégal");
                // La bibliothèque s'occupe de remettre la pièce à sa place
                return;
            }

            // Si le coup est légal, on met à jour la position sur l'échiquier visuel
            board.setPosition(game.fen());
        }

        // 4. On crée l'échiquier visuel avec sa configuration
        const board = new Chessboard(boardElement, {
            position: FEN.start, // Position de départ
            style: {
                // On utilise les noms de couleurs CSS que nous définirons dans style.css
                lightSquare: "var(--board-color-light)",
                darkSquare: "var(--board-color-dark)",
                pieces: {
                    // On choisit des pièces SVG, noires et blanches
                    file: "pieces/staunty.svg" 
                }
            },
            // On indique à la bibliothèque où trouver les fichiers des pièces
            assetsUrl: "https://cdn.jsdelivr.net/npm/cm-chessboard@8.5.4/assets/"
        });

        // 5. On active la possibilité pour l'utilisateur de bouger les pièces
        board.enableMoveInput(handleMove);

    </script>

</body>
</html>
